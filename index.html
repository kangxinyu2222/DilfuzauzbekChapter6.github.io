<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Uzbek Ch6 Vocab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
        
        /* 核心修复：使用 100dvh 适配移动端视口，防止底部被遮挡 */
        html, body { 
            height: 100%;
            height: 100dvh; 
            width: 100%;
            overflow: hidden;
            position: fixed; /* 锁定页面，防止整体橡皮筋效果 */
        }

        body { 
            font-family: 'Nunito', sans-serif; 
            background-color: #f3f4f6; 
            overscroll-behavior: none; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }

        /* 底部安全区域适配 (iPhone X+) */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* 3D Flip Card */
        .perspective { perspective: 1000px; }
        .card-inner {
            position: relative; width: 100%; height: 100%;
            text-align: center; transition: transform 0.5s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .card-front { background: white; color: #1f2937; z-index: 2; }
        .card-back { background: #2563eb; color: white; transform: rotateY(180deg); z-index: 1; }

        /* Game Grid */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        .game-card { 
            aspect-ratio: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            line-height: 1.1;
            padding: 0.25rem;
            text-align: center;
            word-break: break-word;
            transition: transform 0.1s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            background-color: white;
            border: 1px solid #e5e7eb;
        }
        .game-card:active { transform: scale(0.95); }
        .game-card.selected { background-color: #fbbf24; border: 2px solid #d97706; transform: scale(1.05); z-index: 10; font-weight: 800;}
        .game-card.matched { opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .game-card.wrong { background-color: #fee2e2; border: 2px solid #ef4444; animation: shake 0.4s; }

        @keyframes shake { 
            0%, 100% { transform: translateX(0); } 
            25% { transform: translateX(-4px); } 
            75% { transform: translateX(4px); } 
        }

        /* Navigation */
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #9ca3af; font-size: 0.75rem; }
        .nav-item.active { color: #2563eb; font-weight: bold; }
        .nav-item svg { width: 1.5rem; height: 1.5rem; margin-bottom: 2px; }

        /* Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col bg-gray-50">

    <!-- Top Header -->
    <header class="h-auto min-h-[3.5rem] bg-blue-600 shadow-md flex items-center justify-between z-20 px-4 py-2 shrink-0 relative">
        <div class="flex flex-col">
            <h1 class="text-base font-bold text-white tracking-tight">Chapter6: kundalik ishlar</h1>
            <p class="text-[10px] text-blue-100 scale-95 origin-top-left mt-0.5">Design by Dilfuza (telegram@diffila) 小红书号：410803917</p>
        </div>
        <div id="header-score" class="text-xs font-bold text-blue-600 hidden bg-white px-3 py-1 rounded-full absolute right-4 top-1/2 -translate-y-1/2 shadow-sm">Score: 0</div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 relative w-full overflow-hidden">
        
        <!-- VIEW 1: FLASHCARDS (With Audio) -->
        <div id="view-flashcards" class="w-full h-full flex flex-col items-center justify-start pt-4 pb-4 px-4 overflow-y-auto no-scrollbar">
            
            <!-- Category Filter -->
            <div class="w-full overflow-x-auto no-scrollbar mb-4 shrink-0">
                <div class="flex space-x-2 px-1">
                    <button onclick="filterCards('all')" class="cat-btn bg-blue-600 text-white px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap shadow-sm">All</button>
                    <button onclick="filterCards('verb')" class="cat-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap shadow-sm border">动词 Verbs</button>
                    <button onclick="filterCards('noun')" class="cat-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap shadow-sm border">名词 Nouns</button>
                    <button onclick="filterCards('time')" class="cat-btn bg-white text-gray-600 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap shadow-sm border">时间 Time</button>
                </div>
            </div>

            <!-- Card -->
            <div class="w-full max-w-sm aspect-[4/5] perspective relative mb-6 shrink-0">
                <div class="card-inner bg-white" id="flashcard" onclick="flipCard()">
                    <!-- Front -->
                    <div class="card-face card-front border border-gray-100">
                        <div class="absolute top-4 right-4 text-xs font-bold text-gray-300 bg-gray-50 px-2 py-1 rounded" id="card-cat">VERB</div>
                        <div class="text-blue-500 w-24 h-24 mb-6" id="card-icon"></div>
                        <h2 class="text-4xl font-bold text-gray-800 mb-2 text-center px-2" id="card-uzbek">...</h2>
                        <p class="text-gray-400 text-xs mt-4 animate-pulse">点击翻转 / Tap to flip</p>
                    </div>
                    <!-- Back -->
                    <div class="card-face card-back bg-gradient-to-br from-blue-500 to-blue-600">
                        <h3 class="text-2xl font-bold mb-1" id="card-chinese">...</h3>
                        <div class="w-8 h-0.5 bg-white/30 my-2 rounded"></div>
                        <h3 class="text-xl font-semibold text-blue-100 italic mb-6" id="card-english">...</h3>
                        <div class="absolute bottom-6 opacity-50 w-8 h-8" id="card-icon-sm"></div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center justify-between w-full max-w-sm px-2 shrink-0 pb-20">
                <button onclick="prevCard()" class="p-4 rounded-full bg-white shadow text-gray-500 active:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
                </button>
                <div class="text-xs font-mono text-gray-400" id="card-counter">1/100</div>
                <button onclick="speakWord()" class="p-5 rounded-full bg-blue-600 shadow-lg shadow-blue-200 text-white active:scale-95 transition transform">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg>
                </button>
                <button onclick="nextCard()" class="p-4 rounded-full bg-white shadow text-gray-500 active:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/></svg>
                </button>
            </div>
        </div>

        <!-- VIEW 2: GAME (No Audio, One Screen) -->
        <div id="view-game" class="w-full h-full hidden flex flex-col px-4 pt-4 pb-safe">
            <div class="flex justify-between items-end mb-4 shrink-0">
                <div>
                    <h2 class="text-lg font-bold text-gray-800">配对消除</h2>
                    <p class="text-xs text-gray-500">点击单词和对应中文</p>
                </div>
                <button onclick="initGame()" class="text-xs bg-blue-100 text-blue-700 px-4 py-2 rounded-full font-bold shadow-sm active:scale-95 transition">
                    <span class="mr-1">↻</span> 刷新
                </button>
            </div>
            
            <div class="flex-1 flex flex-col justify-center w-full overflow-hidden pb-16">
                <div id="game-grid">
                    <!-- Cards will be injected here -->
                </div>
            </div>
        </div>

        <!-- VIEW 3: QUIZ (SFX Only, Auto Jump) -->
        <div id="view-quiz" class="w-full h-full hidden flex flex-col items-center justify-center pt-4 pb-20 px-6">
            <div class="w-full max-w-sm bg-white rounded-2xl shadow-lg p-6 relative border border-gray-100">
                <!-- Progress Bar -->
                <div class="absolute top-0 left-0 h-1.5 bg-green-500 rounded-tl-2xl rounded-tr-2xl transition-all duration-300" id="quiz-progress" style="width: 10%"></div>
                
                <div class="text-center mb-6 mt-2">
                    <div id="quiz-icon" class="w-16 h-16 text-blue-500 mx-auto mb-3"></div>
                    <h2 class="text-2xl font-bold text-gray-800 leading-tight" id="quiz-question">...</h2>
                    <!-- Audio button removed here as requested -->
                </div>

                <div id="quiz-options" class="flex flex-col gap-2.5">
                    <!-- Options injected here -->
                </div>

                <div id="quiz-feedback" class="mt-4 text-center font-bold text-sm hidden py-2 rounded"></div>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="h-16 bg-white border-t border-gray-100 flex justify-around items-center shrink-0 z-30 pb-safe shadow-[0_-1px_3px_rgba(0,0,0,0.05)] w-full relative">
        <div onclick="switchView('flashcards')" class="nav-item active" id="nav-flashcards">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
            <span class="text-[10px]">背单词</span>
        </div>
        <div onclick="switchView('game')" class="nav-item" id="nav-game">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"/></svg>
            <span class="text-[10px]">连连看</span>
        </div>
        <div onclick="switchView('quiz')" class="nav-item" id="nav-quiz">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            <span class="text-[10px]">测试</span>
        </div>
    </nav>

    <script>
        // --- AUDIO SYSTEM (SFX ONLY) ---
        // TTS logic is separate and only for flashcards
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                // "Ding" sound
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
                osc.start(now);
                osc.stop(now + 0.6);
            } else {
                // "Buzz" sound
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }

        // --- TTS Logic (Only used in Flashcards) ---
        function speakWord(text) {
            const word = text || cardList[cardIndex].u;
            
            // Try Google Translate TTS first
            const onlineUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=uz&client=tw-ob&q=${encodeURIComponent(word)}`;
            const audio = new Audio(onlineUrl);
            
            audio.play().catch(e => {
                // Fallback to System TTS
                if ('speechSynthesis' in window) {
                    const u = new SpeechSynthesisUtterance(word);
                    const voices = window.speechSynthesis.getVoices();
                    const tr = voices.find(v => v.lang.includes('tr')); // Turkish is close to Uzbek
                    if(tr) u.voice = tr;
                    u.rate = 0.85;
                    window.speechSynthesis.speak(u);
                }
            });
        }

        // --- DATA ---
        // Icons
        const SVG = {
            verb: '<path d="M13 10V3L4 14h7v7l9-11h-7z" />',
            time: '<path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />',
            place: '<path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />',
            noun: '<path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />',
            food: '<path d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />',
            person: '<path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />'
        };

        // Full Vocabulary
        const rawVocab = [
            { u: "asli", c: "原来", e: "original / by origin", t: "adj" },
            { u: "ayniqsa", c: "特别", e: "especially", t: "adj" },
            { u: "aytgancha", c: "顺便说一下", e: "by the way", t: "adj" },
            { u: "ba'zan", c: "有时", e: "sometimes", t: "time" },
            { u: "bank", c: "银行", e: "bank", t: "place" },
            { u: "barvaqt", c: "早", e: "early", t: "time" },
            { u: "bayram", c: "节日", e: "holiday", t: "noun" },
            { u: "bemalol", c: "流利地/轻松地", e: "freely / fluently", t: "adj" },
            { u: "bilmoq", c: "知道/懂", e: "to know", t: "verb" },
            { u: "bir haftadan keyin", c: "一周后", e: "after one week", t: "time" },
            { u: "bo'lib ishlamoq", c: "作为...工作", e: "to work as", t: "verb" },
            { u: "bormoq", c: "去", e: "to go", t: "verb" },
            { u: "bozor", c: "市场", e: "bazaar / market", t: "place" },
            { u: "dars qilmoq", c: "学习/做功课", e: "to do homework / study", t: "verb" },
            { u: "davom ettirmoq", c: "继续", e: "to continue", t: "verb" },
            { u: "doim", c: "总是", e: "always", t: "time" },
            { u: "ertaga", c: "明天", e: "tomorrow", t: "time" },
            { u: "ertalab", c: "早上", e: "in the morning", t: "time" },
            { u: "fan", c: "学科", e: "subject / science", t: "noun" },
            { u: "hafta", c: "周", e: "week", t: "time" },
            { u: "har kuni", c: "每天", e: "every day", t: "time" },
            { u: "har xil", c: "各种各样", e: "various / different", t: "adj" },
            { u: "hech kim", c: "没有人", e: "nobody", t: "person" },
            { u: "hech qachon", c: "从不", e: "never", t: "time" },
            { u: "hech qayer", c: "无处", e: "nowhere", t: "place" },
            { u: "hovli", c: "庭院/院子", e: "yard / courtyard", t: "place" },
            { u: "hozir", c: "现在", e: "now", t: "time" },
            { u: "ichmoq", c: "喝", e: "to drink", t: "verb" },
            { u: "indinga", c: "后天", e: "day after tomorrow", t: "time" },
            { u: "ish", c: "工作 (名词)", e: "work / job", t: "noun" },
            { u: "ishlamoq", c: "工作 (动词)", e: "to work", t: "verb" },
            { u: "kamdan-kam", c: "很少", e: "seldom / rarely", t: "time" },
            { u: "kech", c: "晚/迟", e: "late", t: "time" },
            { u: "kechki ovqat", c: "晚餐", e: "dinner", t: "food" },
            { u: "kechqurun", c: "晚上", e: "in the evening", t: "time" },
            { u: "kelajakda", c: "未来", e: "in the future", t: "time" },
            { u: "kelasi yil", c: "明年", e: "next year", t: "time" },
            { u: "kelmoq", c: "来", e: "to come", t: "verb" },
            { u: "keng", c: "宽/广阔", e: "wide / spacious", t: "adj" },
            { u: "ketmoq", c: "离开/走", e: "to leave / go away", t: "verb" },
            { u: "keyin", c: "之后", e: "after / then", t: "time" },
            { u: "kino", c: "电影", e: "cinema / movie", t: "noun" },
            { u: "ko'p", c: "多", e: "many / much", t: "adj" },
            { u: "ko'rmoq", c: "看/见", e: "to see / watch", t: "verb" },
            { u: "kofe/qahva", c: "咖啡", e: "coffee", t: "food" },
            { u: "konsert", c: "音乐会", e: "concert", t: "noun" },
            { u: "kun", c: "天/日", e: "day", t: "time" },
            { u: "kundalik", c: "日常的/日记", e: "daily / diary", t: "adj" },
            { u: "kunduz", c: "白天", e: "daytime", t: "time" },
            { u: "kvartira", c: "公寓", e: "apartment", t: "place" },
            { u: "maktab", c: "学校", e: "school", t: "place" },
            { u: "mashina", c: "汽车", e: "car", t: "noun" },
            { u: "mashina haydamoq", c: "开车", e: "to drive a car", t: "verb" },
            { u: "milliy", c: "民族的/国家的", e: "national", t: "adj" },
            { u: "mumtoz musiqa", c: "古典音乐", e: "classical music", t: "noun" },
            { u: "Mustaqillik kuni", c: "独立日", e: "Independence Day", t: "noun" },
            { u: "Navro'z", c: "纳吾肉孜节", e: "Navruz (New Year)", t: "noun" },
            { u: "nishonlamoq", c: "庆祝", e: "to celebrate", t: "verb" },
            { u: "nonushta qilmoq", c: "吃早餐", e: "to have breakfast", t: "verb" },
            { u: "odatda", c: "通常", e: "usually", t: "time" },
            { u: "ovqat pishirmoq", c: "做饭", e: "to cook", t: "verb" },
            { u: "peshin", c: "中午", e: "noon / midday", t: "time" },
            { u: "qachon", c: "什么时候", e: "when", t: "time" },
            { u: "qaytmoq", c: "回来/返回", e: "to return", t: "verb" },
            { u: "qilmoq", c: "做", e: "to do", t: "verb" },
            { u: "qimmat", c: "贵", e: "expensive", t: "adj" },
            { u: "qishloq", c: "村庄", e: "village", t: "place" },
            { u: "qulay", c: "舒适/方便", e: "comfortable / convenient", t: "adj" },
            { u: "saroy", c: "宫殿", e: "palace", t: "place" },
            { u: "saylga chiqmoq", c: "去野餐/游玩", e: "to go for a walk/picnic", t: "verb" },
            { u: "sevmoq", c: "爱", e: "to love", t: "verb" },
            { u: "siyosat", c: "政治", e: "politics", t: "noun" },
            { u: "soat nechada", c: "几点", e: "at what time", t: "time" },
            { u: "sotib olmoq", c: "买", e: "to buy", t: "verb" },
            { u: "sport", c: "运动", e: "sport", t: "noun" },
            { u: "so'ng", c: "然后/之后", e: "after / then", t: "time" },
            { u: "tanaffus", c: "休息/课间", e: "break / recess", t: "time" },
            { u: "tanaffusga chiqmoq", c: "去休息", e: "to go on a break", t: "verb" },
            { u: "tanimoq", c: "认识", e: "to recognize / know", t: "verb" },
            { u: "taxminan", c: "大约", e: "approximately", t: "adj" },
            { u: "tez-tez", c: "经常", e: "often", t: "time" },
            { u: "tinglamoq", c: "听", e: "to listen", t: "verb" },
            { u: "tugamoq", c: "结束", e: "to finish / end", t: "verb" },
            { u: "tun", c: "夜晚", e: "night", t: "time" },
            { u: "turmoq", c: "站/起床/住", e: "to stand / get up / stay", t: "verb" },
            { u: "tushlik qilmoq", c: "吃午餐", e: "to have lunch", t: "verb" },
            { u: "uch xonali", c: "三居室的", e: "three-room", t: "adj" },
            { u: "uchrashmoq", c: "见面", e: "to meet", t: "verb" },
            { u: "uxlamoq", c: "睡觉", e: "to sleep", t: "verb" },
            { u: "uxlashga yotmoq", c: "去睡觉", e: "to go to bed", t: "verb" },
            { u: "uyg'onmoq", c: "醒来", e: "to wake up", t: "verb" },
            { u: "uy vazifasi", c: "家庭作业", e: "homework", t: "noun" },
            { u: "xona", c: "房间", e: "room", t: "place" },
            { u: "yaxshi ko'rmoq", c: "喜欢", e: "to like", t: "verb" },
            { u: "yemoq", c: "吃", e: "to eat", t: "verb" },
            { u: "yomon ko'rmoq", c: "讨厌/不喜欢", e: "to dislike / hate", t: "verb" },
            { u: "yuvinmoq", c: "洗漱", e: "to wash oneself", t: "verb" },
            { u: "o'qimoq", c: "读/学习", e: "to read / study", t: "verb" },
            { u: "o'rganmoq", c: "学习(学会)", e: "to learn", t: "verb" },
            { u: "o'tirish", c: "聚会/坐", e: "sitting / party", t: "noun" },
            { u: "o'ynamoq", c: "玩", e: "to play", t: "verb" },
            { u: "o'yin", c: "游戏", e: "game", t: "noun" },
            { u: "O'zingizmisiz?", c: "是你吗？", e: "Is that you? / Are you alone?", t: "noun" },
            { u: "shahmat", c: "国际象棋", e: "chess", t: "noun" },
            { u: "chekmoq", c: "抽烟", e: "to smoke", t: "verb" },
            { u: "Dushanba", c: "星期一", e: "Monday", t: "time" },
            { u: "Seshanba", c: "星期二", e: "Tuesday", t: "time" },
            { u: "Chorshanba", c: "星期三", e: "Wednesday", t: "time" },
            { u: "Payshanba", c: "星期四", e: "Thursday", t: "time" },
            { u: "Juma", c: "星期五", e: "Friday", t: "time" },
            { u: "Shanba", c: "星期六", e: "Saturday", t: "time" },
            { u: "Yakshanba", c: "星期日", e: "Sunday", t: "time" },
            { u: "Yanvar", c: "一月", e: "January", t: "time" },
            { u: "Fevral", c: "二月", e: "February", t: "time" },
            { u: "Mart", c: "三月", e: "March", t: "time" },
            { u: "Aprel", c: "四月", e: "April", t: "time" },
            { u: "May", c: "五月", e: "May", t: "time" },
            { u: "Iyun", c: "六月", e: "June", t: "time" },
            { u: "Iyul", c: "七月", e: "July", t: "time" },
            { u: "Avgust", c: "八月", e: "August", t: "time" },
            { u: "Sentabr", c: "九月", e: "September", t: "time" },
            { u: "Oktabr", c: "十月", e: "October", t: "time" },
            { u: "Noyabr", c: "十一月", e: "November", t: "time" },
            { u: "Dekabr", c: "十二月", e: "December", t: "time" }
        ];

        // Process Vocabulary
        const vocabulary = rawVocab.map((item, idx) => ({
            id: idx,
            ...item,
            iconPath: SVG[item.t] || SVG.noun
        }));

        // --- APP STATE ---
        let currentView = 'flashcards';
        let cardList = [...vocabulary];
        let cardIndex = 0;
        let isFlipped = false;
        
        let gameCards = [];
        let firstSelection = null;
        let gameScore = 0;
        let matchedPairs = 0;
        let isGameProcessing = false; // Flag to prevent multi-click

        let quizList = [];
        let quizIndex = 0;
        let currentQuizItem = null;

        // --- UTILS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- INITIALIZATION ---
        window.onload = () => {
            cardList = shuffleArray([...vocabulary]); 
            renderCard();
            initGame();
            initQuiz();
        };

        function switchView(viewId) {
            // Hide all
            document.getElementById('view-flashcards').classList.add('hidden');
            document.getElementById('view-game').classList.add('hidden');
            document.getElementById('view-quiz').classList.add('hidden');
            document.getElementById('header-score').classList.add('hidden');
            
            // Deactivate nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'text-blue-600'));
            
            // Show Target
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            document.getElementById(`nav-${viewId}`).classList.add('active', 'text-blue-600');
            
            if(viewId === 'game') document.getElementById('header-score').classList.remove('hidden');

            currentView = viewId;
        }

        // --- FLASHCARD LOGIC ---
        function filterCards(cat) {
            let filtered;
            if (cat === 'all') filtered = [...vocabulary];
            else filtered = vocabulary.filter(v => v.t === cat);
            
            // Visual feedback for buttons
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-white', 'text-gray-600');
                if(btn.textContent.toLowerCase().includes(cat)) {
                    btn.classList.remove('bg-white', 'text-gray-600');
                    btn.classList.add('bg-blue-600', 'text-white');
                }
            });

            cardList = shuffleArray(filtered); 
            cardIndex = 0;
            isFlipped = false;
            document.getElementById('flashcard').classList.remove('is-flipped');
            renderCard();
        }

        function renderCard() {
            if (cardList.length === 0) return;
            const item = cardList[cardIndex];
            
            document.getElementById('card-uzbek').innerText = item.u;
            document.getElementById('card-chinese').innerText = item.c;
            document.getElementById('card-english').innerText = item.e;
            document.getElementById('card-cat').innerText = item.t.toUpperCase();
            document.getElementById('card-counter').innerText = `${cardIndex + 1}/${cardList.length}`;
            
            // Render Icon
            const iconSvg = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${item.iconPath}</svg>`;
            document.getElementById('card-icon').innerHTML = iconSvg;
            document.getElementById('card-icon-sm').innerHTML = iconSvg;
        }

        function flipCard() {
            const el = document.getElementById('flashcard');
            isFlipped = !isFlipped;
            el.classList.toggle('is-flipped', isFlipped);
        }

        function nextCard() {
            cardIndex = (cardIndex + 1) % cardList.length;
            resetFlip();
            setTimeout(renderCard, 150);
        }

        function prevCard() {
            cardIndex = (cardIndex - 1 + cardList.length) % cardList.length;
            resetFlip();
            setTimeout(renderCard, 150);
        }

        function resetFlip() {
            const el = document.getElementById('flashcard');
            isFlipped = false;
            el.classList.remove('is-flipped');
        }

        function speakWord(text) {
            const word = text || cardList[cardIndex].u;
            
            const onlineUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=uz&client=tw-ob&q=${encodeURIComponent(word)}`;
            const audio = new Audio(onlineUrl);
            
            audio.play().catch(e => {
                if ('speechSynthesis' in window) {
                    const u = new SpeechSynthesisUtterance(word);
                    const voices = window.speechSynthesis.getVoices();
                    const tr = voices.find(v => v.lang.includes('tr'));
                    if(tr) u.voice = tr;
                    u.rate = 0.85;
                    window.speechSynthesis.speak(u);
                }
            });
        }

        // --- GAME LOGIC ---
        function initGame() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            gameScore = 0;
            matchedPairs = 0;
            firstSelection = null;
            isGameProcessing = false;
            document.getElementById('header-score').innerText = "Score: 0";

            const subset = [...vocabulary].sort(() => 0.5 - Math.random()).slice(0, 6);
            let deck = [];
            subset.forEach(item => {
                deck.push({ id: item.id, content: item.u, type: 'u' }); 
                deck.push({ id: item.id, content: item.c, type: 'c' });
            });
            deck.sort(() => 0.5 - Math.random());

            deck.forEach(card => {
                const el = document.createElement('div');
                el.className = 'game-card bg-white text-gray-800 font-bold border border-gray-200';
                el.innerText = card.content;
                if (card.type === 'c') el.classList.add('text-blue-600');
                
                el.onclick = () => handleGameClick(el, card);
                grid.appendChild(el);
            });
        }

        function handleGameClick(el, card) {
            if (isGameProcessing) return; // Prevent clicks during shake/timeout
            if (el.classList.contains('matched') || el.classList.contains('selected')) return;
            
            // NO AUDIO for Game

            el.classList.add('selected');

            if (!firstSelection) {
                firstSelection = { el, card };
            } else {
                // Check match
                isGameProcessing = true; // Lock
                if (firstSelection.card.id === card.id && firstSelection.card.type !== card.type) {
                    // Match
                    setTimeout(() => {
                        el.classList.remove('selected');
                        firstSelection.el.classList.remove('selected');
                        el.classList.add('matched');
                        firstSelection.el.classList.add('matched');
                        firstSelection = null;
                        isGameProcessing = false; // Unlock
                    }, 200);
                    gameScore += 10;
                    matchedPairs++;
                    if(matchedPairs === 6) {
                        setTimeout(() => {
                            if(confirm('恭喜通关！再来一局？')) initGame();
                        }, 500);
                    }
                } else {
                    // Mismatch
                    el.classList.add('wrong');
                    firstSelection.el.classList.add('wrong');
                    setTimeout(() => {
                        el.classList.remove('selected', 'wrong');
                        firstSelection.el.classList.remove('selected', 'wrong');
                        firstSelection = null;
                        isGameProcessing = false; // Unlock
                    }, 600);
                    gameScore = Math.max(0, gameScore - 2);
                }
                document.getElementById('header-score').innerText = `Score: ${gameScore}`;
            }
        }

        // --- QUIZ LOGIC ---
        function initQuiz() {
            quizList = [...vocabulary].sort(() => 0.5 - Math.random()).slice(0, 10);
            quizIndex = 0;
            renderQuiz();
        }

        function renderQuiz() {
            if (quizIndex >= quizList.length) {
                document.getElementById('quiz-question').innerText = "测试完成!";
                document.getElementById('quiz-icon').innerHTML = '<svg class="w-full h-full text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                document.getElementById('quiz-options').innerHTML = `<button onclick="initQuiz()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">再测一次 Restart</button>`;
                document.getElementById('quiz-feedback').classList.add('hidden');
                return;
            }

            currentQuizItem = quizList[quizIndex];
            document.getElementById('quiz-question').innerText = currentQuizItem.u;
            document.getElementById('quiz-icon').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${currentQuizItem.iconPath}</svg>`;
            document.getElementById('quiz-progress').style.width = `${((quizIndex)/10)*100}%`;
            
            const wrongOpts = vocabulary.filter(v => v.id !== currentQuizItem.id).sort(() => 0.5 - Math.random()).slice(0, 3);
            const options = [currentQuizItem, ...wrongOpts].sort(() => 0.5 - Math.random());

            const container = document.getElementById('quiz-options');
            container.innerHTML = '';
            document.getElementById('quiz-feedback').classList.add('hidden');

            // NO AUTO SPEAK for Quiz

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'w-full bg-gray-50 hover:bg-gray-100 border border-gray-200 text-gray-700 py-3 px-4 rounded-xl text-left font-semibold transition active:scale-98';
                btn.innerHTML = `<div>${opt.c}</div><div class="text-xs text-gray-400 font-normal">${opt.e}</div>`;
                btn.onclick = () => checkQuiz(btn, opt.id === currentQuizItem.id);
                container.appendChild(btn);
            });
        }

        function checkQuiz(btn, isCorrect) {
            const btns = document.getElementById('quiz-options').children;
            for(let b of btns) b.disabled = true;

            const feedback = document.getElementById('quiz-feedback');
            feedback.classList.remove('hidden');
            
            if (isCorrect) {
                btn.classList.remove('bg-gray-50');
                btn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                feedback.innerText = "✅ 回答正确! Correct!";
                feedback.className = "mt-4 text-center font-bold text-sm text-green-600 bg-green-50 p-2 rounded";
                playSound('correct'); 
                
                // Correct: 1 second delay
                setTimeout(() => {
                    nextQuiz();
                }, 1000);

            } else {
                btn.classList.remove('bg-gray-50');
                btn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                feedback.innerText = `❌ 正确答案: ${currentQuizItem.c}`;
                feedback.className = "mt-4 text-center font-bold text-sm text-red-600 bg-red-50 p-2 rounded";
                playSound('wrong'); 
                
                // Highlight correct one
                for(let b of btns) {
                    if (b.innerHTML.includes(currentQuizItem.c)) {
                        b.classList.add('bg-green-100', 'border-green-500');
                    }
                }

                // Wrong: 1.5 second delay
                setTimeout(() => {
                    nextQuiz();
                }, 1500);
            }
        }

        function nextQuiz() {
            quizIndex++;
            renderQuiz();
        }

    </script>
</body>
</html>
